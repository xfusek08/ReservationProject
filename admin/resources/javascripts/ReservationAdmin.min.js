function LoadActNavigation(){SendAjaxRequest("type=getnavigation",!0,function(e){var t=new Date,n=$(e).find("date").text(),i=$(e).find("temrpk").text();""!=n&&(t=StrToDate(n)),LoadMonthOverview(t,!0,function(){SelectTerm(i),GetNewReservations()})})}function InitDatePicker(){PrevDate=new Date,$.datepicker.regional.cs={closeText:"Cerrar",prevText:"<",nextText:">",currentText:"Hoy",monthNames:["Leden","Únor","Březen","Duben","Květen","Červen","Červenec","Srpen","Září","Říjen","Listopad","Prosinec"],monthNamesShort:["Leden","Únor","Březen","Duben","Květen","Červen","Červenec","Srpen","Září","Říjen","Listopad","Prosinec"],dayNames:["Neděle","Pondělí","Úterý","Středa","Čtvrtek","Pátek","Sobota"],dayNamesShort:["Ne","Po","Út","St","Čt","Pá","So"],dayNamesMin:["Ne","Po","Út","St","Čt","Pá","So"],weekHeader:"Sm",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!0,showMonthAfterYear:!1,yearSuffix:"",showOtherMonths:!0,selectOtherMonths:!0,numberOfMonths:1,changeMonth:!0,changeYear:!0,showButtonPanel:!1},$.datepicker.setDefaults($.datepicker.regional.cs),$("#datepicker").datepicker({onSelect:function(e){DateSelect($(this),e)},afterShow:function(e,t,n){AfterLoadDays($(this)),$(this).find(".ui-datepicker-title").append('<button class="today">Dnes</button>')},onChangeMonthYear:function(e,t){var n=$(this).datepicker("getDate");LoadMonthData(!0,new Date(e,t-2,1),new Date(e,t,1),function(){LoadMonthReservationData(!0,new Date(e,t-2,1),new Date(e,t,1),function(){LoadTermsDayView(n&&n.getMonth()+1==t&&n.getFullYear()==e?DateToStr(n):""),"function"==typeof changeonyearfunc&&changeonyearfunc()})})}}).on("click","button.today",function(){DateSelect($("#datepicker"),DateToStr(new Date))})}function AfterLoadDays(e){e.find("table td").each(function(){var e=parseInt($(this).find("*").text()),t=parseInt($(this).attr("data-month")),n=parseInt($(this).attr("data-year")),i=new Date(n,t,e),a=$(TermMonthdata).find('day[date="'+DateToStr(i)+'"]'),o=0,r=0,s=0,d='<div class="termdata">';a.length>0&&(o=a.find("term[state=0]").size(),r=a.find("term[state=2]").size(),s=a.find("term[state=1]").size(),parseInt(o)>0?d=d+'<div class="freetermnum">'+o+"</div>":d+="<div></div>",parseInt(r)>0?d=d+'<div class="invisiblenum">'+r+"</div>":d+="<div></div>",parseInt(s)>0?d=d+'<div class="reservationnum">'+s+"</div>":d+="<div></div>"),d+="</div>",$(d).appendTo($(this)),$('.adm-newresconn-conn .reservation[date="'+DateToStr(i)+'"]').length>0&&$(this).css({backgroundColor:"rgb(250,250,0)"}).addClass("hasnew")})}function DateSelect(e,t,n){if(ClearContent()){var i=e.datepicker("getDate").getMonth()==StrToDate(t).getMonth()&&e.datepicker("getDate").getFullYear()==StrToDate(t).getFullYear();i||(changeonyearfunc=function(){"function"==typeof n&&n(),changeonyearfunc=null},e.datepicker("setDate",StrToDate(t))),e.datepicker("setDate",StrToDate(t)),i&&LoadTermsDayView(t,n)}else e.datepicker("setDate",DateToStr(PrevDate));PrevDate=StrToDate(t)}function LoadMonthData(e,t,n,i){SendAjaxRequest("type=getterms&fromdate="+DateToStr(t)+"&todate="+DateToStr(n),e,function(t){var n=$(TermMonthdata);$(t).find("month").each(function(){var e=n.find('month[monthnum="'+$(this).attr("monthnum")+'"]');e.length>0?e.html($(this).html()):$('<month monthnum="'+$(this).attr("monthnum")+'">'+$(this).html()+"</month>").appendTo(n)}),TermMonthdata="<months>"+n.html()+"</months>",e&&$("#datepicker").datepicker("refresh"),"function"==typeof i&&i(t)})}function LoadMonthReservationData(e,t,n,i){SendAjaxRequest("type=getreservations&fromdate="+DateToStr(t)+"&todate="+DateToStr(n),e,function(e){var t=$(TermMonthdata);$(e).find("reservation").each(function(){var e=t.find('term[pk="'+$(this).attr("termpk")+'"]');e.empty(),$(this).appendTo(e)}),TermMonthdata="<months>"+t.html()+"</months>","function"==typeof i&&i(e)})}function LoadMonthOverview(e,t,n){var i=e.getMonth(),a=new Date(e.getFullYear(),i-1,1),o=new Date(e.getFullYear(),i+2,0);LoadMonthData(t,a,o,function(){$("#datepicker").datepicker("setDate",e),LoadMonthReservationData(t,a,o,function(){LoadTermsDayView(DateToStr(e),n)})})}function LoadTermsDayView(e,t){$(".adm-dayterms-view").empty();var n=$(TermMonthdata).find('day[date="'+e+'"]'),i="";0==n.length?(i='<div class="adm-dayterms-view-nodata">Žádná data</div>',$(i).appendTo(".adm-dayterms-view")):n.find("term").each(function(){if(i='<div class="adm-dayterms-view-term" pk="'+$(this).attr("pk")+'">',i+='<div class="adm-dayterms-view-term-time">'+$(this).attr("time")+"</div>",i+='<div class="adm-dayterms-view-term-content">',"0"==$(this).attr("state"))i+='<div class="free">Volno</div>';else if("1"==$(this).attr("state")){var e=$(this).find("reservation");i+='<div class="ontermreservation">',i+="<table>",i+="<tr>",i+="<td>Voucher:</td><td>"+e.attr("vouchernum")+"</td>",i+="</tr>",i+="<tr>",i+="<td>Jméno:</td><td>"+e.attr("firstname")+" "+e.attr("lastname")+"</td>",i+="</tr>",i+="</table>",i+="</div>"}else if("2"==$(this).attr("state")){var e=$(this).find("reservation");i+='<div class="invisible">Skryté</div>'}i+="</div>",i+="</div>",$(i).appendTo(".adm-dayterms-view"),$('.adm-newresconn-conn .reservation[termpk="'+$(this).attr("pk")+'"]').length>0&&AppendNewTagToTerm($(this).attr("pk"),!1)}),CreateDroppables(),t&&"function"==typeof t&&t()}function BuildFreeResConn(){FreeResConn=$(".adm-freeresconn");var e=$(window).outerHeight()-$(".adm-topheader").outerHeight();500>e&&(e=500),$(".adm-leftpanel-intable").height(e),SetUpConnHeight(),FreeResConn.width($(".adm-upconn").width()),$(window).resize(function(){var e=$(window).outerHeight()-$(".adm-topheader").outerHeight();500>e&&(e=500),$(".adm-leftpanel-intable").height(e),SetUpConnHeight(),$(".adm-upconn").width($(window).outerWidth()-$(".adm-leftpanel").outerWidth()),FreeResConn.width($(".adm-upconn").width())}),FreeResConn.on("click",".freeresconn-caption",ToggleUpDown)}function SetUpConnHeight(){var e=0;Minimized?(FreeResConn.find(".freeresconn-conn").height(0),e=$(".adm-leftpanel-intable").outerHeight()-FreeResConn.find(".freeresconn-caption").outerHeight()-31):(FreeResConn.find(".freeresconn-conn").height(Freeresconnheight-FreeResConn.find(".freeresconn-caption").outerHeight()),e=$(".adm-leftpanel-intable").outerHeight()-Freeresconnheight-31),$(".adm-upconn > div .adm-newresconn-conn").css({height:e+"px"}),$(".adm-upconn > div .adm-day-conn").css({height:e+"px"}),$(".adm-upconn").height(e)}function ToggleUpDown(){var e=0;Minimized?(e=Freeresconnheight-FreeResConn.find(".freeresconn-caption").outerHeight(),FreeResConn.find(".freeresconn-conn").animate({height:"+="+e+"px"},250,"swing"),$(".adm-upconn > div .adm-day-conn").animate({height:"-="+e+"px"},250,"swing"),$(".adm-upconn > div .adm-newresconn-conn").animate({height:"-="+e+"px"},250,"swing"),$(".conndetail-inhtml .reservations").animate({maxHeight:"-="+e+"px"},250,"swing"),$(".adm-upconn").stop().animate({height:"-="+e+"px"},250,"swing",function(){FreeResConn.find(".freeresconn-caption").find(".maxminbt img").attr("src","../images/Down.png"),Minimized=!1,SetUpConnHeight()})):(e=Freeresconnheight-FreeResConn.find(".freeresconn-caption").outerHeight(),FreeResConn.find(".freeresconn-conn").animate({height:"-="+e+"px"},250,"swing"),$(".adm-upconn > div .adm-day-conn").animate({height:"+="+e+"px"},250,"swing"),$(".adm-upconn > div .adm-newresconn-conn").animate({height:"+="+e+"px"},250,"swing"),$(".conndetail-inhtml .reservations").animate({maxHeight:"+="+e+"px"},250,"swing"),$(".adm-upconn").stop().animate({height:"+="+e+"px"},250,"swing",function(){FreeResConn.find(".freeresconn-caption").find(".maxminbt img").attr("src","../images/Up.png"),Minimized=!0,SetUpConnHeight()}))}function EnableResGrab(e){var t=e.find(".termdetail-reservation");t.css({border:"2px dashed black",cursor:"pointer"}).draggable({revert:function(){var e=$(this);return setTimeout(function(){e.css("visibility","visible")},300),!0},helper:"clone",cursorAt:{left:5,top:10},revertDuration:300,scroll:!1,scope:"termres",start:function(e,t){$(this).css("visibility","hidden")},stop:function(e,t){}}),CreateResMoveDropper()}function LoadFreeReservations(){SendAjaxRequest("type=getfreeres",!0,function(e){FreeResConn.find(".freeresconn-conn").empty();var t=0,n='<div class="resconn"><table class="header"><tr><td>Číslo voucheru</td><td>Jméno a příjmení</td><td>E-mail</td><td>Telefon</td><td>Adresa</td><td>Vytvořeno</td></tr></table>';$(e).find("reservation").each(function(){t++,n+='<div class="termdetail-reservation" pk="'+$(this).attr("respk")+'"><div class="termdetail-reservation-caption">Rezervace</div><table><tr><td>'+$(this).attr("vouchernum")+"</td><td>"+$(this).attr("firstname")+" "+$(this).attr("lastname")+"</td><td>"+$(this).attr("email")+"</td><td>"+$(this).attr("telnum")+"</td><td>"+$(this).attr("address")+"</td><td>"+$(this).attr("created")+"</td></tr></table></div>"}),n+="</div>",FreeResConn.find(".rescount").text(t);var i=$(n);t>0&&(i.appendTo(FreeResConn.find(".freeresconn-conn")),i.find(".header").css({marginLeft:i.find(".termdetail-reservation-caption").outerWidth()+10}),CalcFreeResContentWidth(),i.find(".termdetail-reservation").each(function(){$(this).draggable({helper:"clone",handle:".termdetail-reservation-caption",cursorAt:{left:5,top:5},revert:function(){return $(this).stop().slideToggle(300,function(){$(this).css("visibility","visible")}),!0},revertDuration:300,scroll:!1,scope:"freeres",start:function(e,t){$(this).css("visibility","hidden"),$(this).stop().slideToggle(300)},stop:function(e,t){}})}),CreateDroppables())})}function CreateDroppables(){$(".ui-droppable").droppable("destroy"),$(".adm-dayterms-view-term").each(function(){var e=0==$(this).find(".ontermreservation").length;if(e){$(this).height();$(this).droppable({tolerance:"pointer",scope:"freeres",over:function(e,t){$(this).css({background:SelBcgrColor})},out:function(e,t){$(this).css({background:"white"})},activate:function(e,t){$(this).hasClass("termsel")||($(this).css("-webkit-box-shadow","0 0 0 0 rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)"),$(this).css("-moz-box-shadow","0 0 0 0 rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)"),$(this).css("box-shadow","0 0 0 0 rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)"),$(this).animate({boxShadow:"0 0 3px 2px, 0 1px 2px 0px rgb(100,100,100)"},"fast",function(){$(this).css("-webkit-box-shadow","0 0 3px 2px rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)"),$(this).css("-moz-box-shadow","0 0 3px 2px rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)"),$(this).css("box-shadow","0 0 3px 2px rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)")}))},deactivate:function(e,t){$(this).hasClass("termsel")||$(this).animate({boxShadow:"0 0 0 0, 0 1px 2px 0px rgb(100,100,100)"},"fast",function(){$(this).css("-webkit-box-shadow","0 1px 2px 0px rgb(100,100,100)"),$(this).css("-moz-box-shadow","0 1px 2px 0px rgb(100,100,100)"),$(this).css("box-shadow","0 1px 2px 0px rgb(100,100,100)")})},drop:function(e,t){var n=$(this),i=$(t.draggable).attr("pk");setTimeout(function(){$(t.helper).remove(),$(t.draggable).draggable("destroy").remove(),SendFreeResMoveRequest(n.attr("pk"),i)},0)}})}}),FreeTermDroppable()}function FreeTermDroppable(){($(".termsel").find(".free").length>0||$(".termsel").find(".invisible").length>0)&&$(".conndetail").droppable({tolerance:"pointer",scope:"freeres",over:function(e,t){$(this).css({background:SelBcgrColor})},out:function(e,t){$(this).css({background:"white"})},activate:function(e,t){$(this).css("-webkit-box-shadow","0 0 0 0 rgb(100,255,100) inset"),$(this).css("-moz-box-shadow","0 0 0 0 rgb(100,255,100) inset"),$(this).css("box-shadow","0 0 0 0 rgb(100,255,100) inset"),$(this).animate({boxShadow:"0 0 3px 2px"},"fast")},deactivate:function(e,t){$(this).animate({boxShadow:"0 0 0 0"},"fast")},drop:function(e,t){var n=$(t.draggable).attr("pk");setTimeout(function(){$(t.draggable).draggable("destroy").remove(),SendFreeResMoveRequest($(".termsel").attr("pk"),n)},0)}})}function CreateResMoveDropper(){$(".ui-droppable").droppable("destroy");var e="rgb(200,255,200)";$(".adm-dayterms-view-term").each(function(){var t=0==$(this).find(".ontermreservation").length;if(t){$(this).height();$(this).droppable({tolerance:"pointer",scope:"termres",over:function(t,n){$(this).css({background:e})},out:function(e,t){$(this).css({background:"white"})},activate:function(e,t){var n="";$(this).hasClass("termsel")&&(n=", 0 0 0px 2px red inset"),$(this).css("-webkit-box-shadow","0 0 0 0 rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)"+n),$(this).css("-moz-box-shadow","0 0 0 0 rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)"+n),$(this).css("box-shadow","0 0 0 0 rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)"+n),$(this).animate({boxShadow:"0 0 3px 2px, 0 1px 2px 0px rgb(100,100,100)"+n},"fast",function(){$(this).css("-webkit-box-shadow","0 0 3px 2px rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)"+n),$(this).css("-moz-box-shadow","0 0 3px 2px rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)"+n),$(this).css("box-shadow","0 0 3px 2px rgb(100,255,100) inset, 0 1px 2px 0px rgb(100,100,100)"+n)})},deactivate:function(e,t){var n="";$(this).hasClass("termsel")&&(n=", 0 0 0px 2px red inset"),$(this).animate({boxShadow:"0 0 0 0, 0 1px 2px 0px rgb(100,100,100)"+n},"fast",function(){$(this).css("-webkit-box-shadow","0 1px 2px 0px rgb(100,100,100)"+n),$(this).css("-moz-box-shadow","0 1px 2px 0px rgb(100,100,100)"+n),$(this).css("box-shadow","0 1px 2px 0px rgb(100,100,100)"+n)})},drop:function(e,t){var n=$(this);setTimeout(function(){$(t.draggable).draggable("destroy").remove(),SendResMoveRequest(n.attr("pk"))},0)}})}}),$(FreeResConn).droppable({tolerance:"pointer",scope:"termres",over:function(t,n){$(this).find(".freeresconn-conn").css({background:e}),Minimized&&ToggleUpDown()},out:function(e,t){$(this).find(".freeresconn-conn").css({background:"white"})},activate:function(e,t){$(this).find(".freeresconn-conn").css("-webkit-box-shadow","0 0 0 0 rgb(100,255,100) inset"),$(this).find(".freeresconn-conn").css("-moz-box-shadow","0 0 0 0 rgb(100,255,100) inset"),$(this).find(".freeresconn-conn").css("box-shadow","0 0 0 0 rgb(100,255,100) inset"),$(this).find(".freeresconn-conn").animate({boxShadow:"0 0 3px 2px"},"fast")},deactivate:function(e,t){$(this).find(".freeresconn-conn").animate({boxShadow:"0 0 0 0"},"fast")},drop:function(e,t){$(this).find(".freeresconn-conn").css({background:"white"}),setTimeout(function(){$(t.draggable).draggable("destroy").remove(),SendResMoveRequest(0)},0)}})}function SendResMoveRequest(e){SendAjaxRequest("type=contentdetail&event=formsubmit&formtype=movereservation&c_submit=ok&newterm="+e,!0,function(e){BuildContentDetailfromXML(e)})}function SendFreeResMoveRequest(e,t){t&&e&&(0>=t||0>=e||(SelectTerm(e),SendAjaxRequest("type=contentdetail&event=formsubmit&formtype=freeresattach&c_submit=ok&reservation="+t,!0,function(e){BuildContentDetailfromXML(e)})))}function CalcFreeResContentWidth(){var e=0,i=0,t=0,a=0,s=0,n=0,r=0;FreeResConn.find("td").each(function(){var d=$(this).width();if(200>=d)switch($(this).index()){case 0:d>e&&(e=d);break;case 1:d>i&&(i=d);break;case 2:d>t&&(t=d);break;case 3:d>a&&(a=d);break;case 4:d>s&&(s=d);break;case 5:d>n&&(n=d);break;case 6:d>r&&(r=d)}}),FreeResConn.find("td").each(function(){switch($(this).index()){case 0:$(this).width(e);break;case 1:$(this).width(i);break;case 2:$(this).width(t);break;case 3:$(this).width(a);break;case 4:$(this).width(s);break;case 5:$(this).width(n);break;case 6:$(this).width(r)}}),FreeResConn.find(".header").width(FreeResConn.find(".termdetail-reservation table").width()),FreeResConn.find(".termdetail-reservation").width(FreeResConn.find(".termdetail-reservation table").width()+FreeResConn.find(".termdetail-reservation-caption").width()+30)}function GetNewReservations(){SendAjaxRequest("type=getnewres",!0,function(e){var t=!1,n=0;$(".adm-newresconn-conn .reservation").each(function(t){if(0==$(e).find('reservation[respk="'+$(this).attr("pk")+'"]').length){var i=$(this);n++,setTimeout(function(){if(n--,i.slideToggle(300,function(){i.mouseout(),i.remove(),$(".adm-newresconn-caption .newrescount").text(n)}),0==$(e).find('reservation[fromdate="'+i.attr("date")+'"]').length){var t=GetCalenDayTDByDate(StrToDate(i.attr("date")),".hasnew");null!=t&&t.animate({backgroundColor:"initial"},300,"swing",function(){$(this).removeClass("hasnew")})}$('.adm-dayterms-view-term[pk="'+i.attr("termpk")+'"] .newtag').animate({opacity:0}),function(){$(this).remove}},500)}}),$(e).find("reservation").each(function(e){if(n++,0==$('.adm-newresconn-conn .reservation[pk="'+$(this).attr("respk")+'"]').length){var i=ReservationXMLtoDivHTML($(this)),a=$(i).css({background:"rgb(245,245,100)"}).hide();a.appendTo(".adm-newresconn-conn"),setTimeout(function(){a.toggle("slide",{direction:"right"},function(){a.mouseover(function(){a.css({background:"rgba(220,250,255,1)"})}),a.mouseout(function(){a.css({background:"rgb(245,245,100)"})})})},150+70*e);var o=GetCalenDayTDByDate(StrToDate($(this).attr("fromdate")),":not(hasnew)");null!=o&&o.animate({backgroundColor:"rgb(250,250,0)"},300,"swing",function(){$(this).addClass("hasnew")});var r=$('.adm-dayterms-view-term[pk="'+$(this).attr("termpk")+'"]');if(r.find(".adm-dayterms-view-term-content > div:not(.reservation)").length>0){r.find(".adm-dayterms-view-term-content").empty();var i='<div class="reservation">';i+="<table>",i+="<tr>",i+="<td>Voucher:</td><td>"+$(this).attr("vouchernum")+"</td>",i+="</tr>",i+="<tr>",i+="<td>Jméno:</td><td>"+$(this).attr("firstname")+" "+$(this).attr("lastname")+"</td>",i+="</tr>",i+="</table>",i+="</div>",$(i).appendTo(r.find(".adm-dayterms-view-term-content")),t=!0}AppendNewTagToTerm($(this).attr("termpk"),!0),$("body").on("mouseover",'.adm-dayterms-view-term[pk="'+a.attr("termpk")+'"]',function(){a.mouseover()}),$("body").on("mouseout",'.adm-dayterms-view-term[pk="'+a.attr("termpk")+'"]',function(){a.mouseout()})}}),$(".adm-newresconn-caption .newrescount").text(n),t&&setTimeout(function(){ReloadData()},300)})}function AppendNewTagToTerm(e,t){var n=$('.adm-dayterms-view-term[pk="'+e+'"]');if(0!=n.length){var i=$('<div class="newtag">Nové</div>');i.css({opacity:0}),i.appendTo(n),i.css({left:n.offset().left+n.width()-i.width()-5,top:n.offset().top+5}),t?i.animate({opacity:1},300,"swing"):i.css({opacity:1})}}function GetCalenDayTDByDate(e,t){var n=null;return $("#datepicker").find('table tbody td[data-month="'+e.getMonth()+'"][data-year="'+e.getFullYear()+'"]'+t).each(function(){$(this).find("a").text()==e.getDate()&&(n=$(this))}),n}function ReservationXMLtoDivHTML(e){var t='<div class="reservation selhover" pk="'+e.attr("respk")+'" termpk="'+e.attr("termpk")+'" date="'+e.attr("fromdate")+'"><div class="term">'+e.attr("fromdate")+", "+e.attr("fromtime")+" ("+e.attr("dayname")+")</div><table><tr><td>Voucher:</td><td>"+e.attr("vouchernum")+"</td></tr><tr><td>Jméno:</td><td>"+e.attr("firstname")+" "+e.attr("lastname")+'</td></tr></table><div class="created"><span>Vytvořeno:</span><span>'+e.attr("created")+"</span></div></div>";return t}function SelectTerm(e){var t=$('.adm-dayterms-view .adm-dayterms-view-term[pk="'+e+'"]');if(!(t.length>0))return!1;if(ClearContent(event)){var n=$(".adm-dayterms-view .adm-dayterms-view-term.termsel");n.removeClass("termsel"),n.css("-webkit-box-shadow","0 1px 2px 0px rgb(100,100,100)"),n.css("-moz-box-shadow","0 1px 2px 0px rgb(100,100,100)"),n.css("box-shadow","0 1px 2px 0px rgb(100,100,100)");var i=$('.adm-newresconn-conn .reservation[termpk="'+e+'"]');t.addClass("termsel"),t.css("-webkit-box-shadow","0 0 0px 2px red inset"),t.css("-moz-box-shadow","0 0 0px 2px red inset"),t.css("box-shadow","0 0 0px 2px red inset"),i.css("-webkit-box-shadow","0 0 0px 2px red inset"),i.css("-moz-box-shadow","0 0 0px 2px red inset"),i.css("box-shadow","0 0 0px 2px red inset"),BuildTermDetail(t)}}function ReloadData(){var e=$(".adm-dayterms-view-term.termsel").attr("pk"),t=$("#datepicker").datepicker("getDate");LoadMonthOverview(t,!0,function(){LoadFreeReservations(),GetNewReservations(),SelectTerm(e)})}function ClearContent(e){var t=!0;return $(".adm-day-conn .checkbeforeclose").length>0&&(t=confirm("Přejete si opravdu opustit neuložený formulář ?")),t?$(".adm-day-conn").empty():e&&e.stopPropagation(),t}function BuildTermsForm(e,t){SendAjaxRequest("type=getnewtermsform&date="+DateToStr(e)+"&tftype="+t,!0,function(e){BuildTermsFormFromXML(e)})}function BuildTermsFormFromXML(e){var t=$(e);t.appendTo(".adm-day-conn"),t.on("click",".seltimebt",function(e){var t=$(this).parent(".timeinput");CreateOnClickTimepicker(e,t,$(this))}),t.on("click",".removetimebt",function(){var e=t.find("tr.datarow:last-child"),n=parseInt(e.attr("cout"));e.remove(),2==n&&$(this).remove()}),t.on("click",".addtimebt",function(){var e=t.find("tr.datarow:last-child").clone(),n=parseInt(e.attr("cout"))+1;e.attr("cout",n),e.find("td:first-child").text(n+"."),e.find('input[type="text"]').attr("name","tt"+n),e.find('input[type="checkbox"]').attr("name","tv"+n),e.find('input[type="text"]').val(""),e.find('input[type="checkbox"]').prop("checked",!0),e.find(".seltimebt.wait").removeClass("wait"),e.find("td").eq(3).remove(),2==n&&$('<div class="removetimebt">Odebrat</div>').appendTo(".newtermsform-options"),e.appendTo(t.find("table"))}),t.on("submit","form",function(e){e.preventDefault()}),t.on("click","input[type=submit]",function(e){OnClickAjaxSubmit(e,"newtermsform",$(this),function(e){t.remove(),"succes"==e?(RaiseAnnouncement("Termíny úspěšně vytvořeny.","green"),ReloadData()):"dbfail"==e?RaiseAnnouncement("Termíny se nepodařilo vytvořit.","red"):BuildTermsFormFromXML(e)})})}function CreateOnClickTimepicker(e,t,n){e.preventDefault(),n.is(".wait")||t.find("input[type=text]").timepicker({timeFormat:"H:i",scrollDefault:"now"}).on("hideTimepicker",function(){$(this).timepicker("remove"),n.addClass("wait"),setTimeout(function(){n.removeClass("wait")},400)}).on("showTimepicker",function(){$(".ui-timepicker-wrapper").css({left:$(this).position().left-4})}).timepicker("show")}function BuildTermDetail(e){SendAjaxRequest("type=gettermdetail&pk="+e.attr("pk"),!0,function(e){BuildContentDetailfromXML(e)})}function BuildContentDetailfromXML(e){$(".adm-day-conn").empty();var t=$(e);if(t.find("alert").each(function(){RaiseAnnouncement($(this).attr("text"),$(this).attr("color"))}),"true"==t.attr("unsett"))return void ReloadData();var n='<div class="conndetail"><div class="conndetail-caption">'+t.attr("caption")+'<div class="conndetail-menu" title="možnosti"><img src="../images/menu.png"/></div></div><div class="conndetail-inhtml">'+t.find("inhtml").html()+"</div></div>",i=$(n).appendTo(".adm-day-conn");i.on("click",".conndetail-menu",function(e){if(e.stopPropagation(),$(this).find("img").animate({height:"-=2px",marginTop:"+=1px",marginRight:"+=1px"},100,function(){$(this).animate({height:"+=2px",marginTop:"-=1px",marginRight:"-=1px"},100)}),$(".conndetail-actions").length>0)$(".conndetail-actions").stop().slideToggle(200,"swing",function(){$(this).remove()});else{var n='<div class="conndetail-actions">';t.find("action").each(function(){n+='<div class="conndetail-actions-action" ident="'+$(this).attr("ident")+'">'+$(this).attr("cap")+"</div>"}),n+="</div>";var a=$(n);a.appendTo("body"),a.css({top:$(this).position().top+$(this).outerHeight()-5,left:$(this).position().left-a.width()+$(this).outerWidth()+"px"}),a.slideToggle(200,"swing"),a.on("click",".conndetail-actions-action",function(e){e.stopPropagation(),ContentDetailActionClick($(this),i),HideAcitons(a)}),$("html").click(function(){HideAcitons(a)})}}),i.find("form").length>0&&(i.on("click",".seltimebt",function(e){var t=$(this).parent(".timeinput");CreateOnClickTimepicker(e,t,$(this))}),i.find("form").submit(function(e){e.preventDefault()}),i.on("click","input[type=submit]",function(e){OnClickAjaxSubmit(e,"contentdetail&event=formsubmit",$(this),function(e){BuildContentDetailfromXML(e)})})),i.find(".scriptinit").length>0&&"movereservation"==i.find(".scriptinit").attr("scriptname")&&EnableResGrab(i),t.attr("focusterm")&&SelectTerm(t.attr("focusterm")),"refresh"==t.attr("refresh")&&ReloadData(),FreeTermDroppable(),GetNewReservations()}function HideAcitons(e){e.stop().slideToggle(200,"swing",function(){e.remove()})}function ContentDetailActionClick(e,t){SendAjaxRequest("type=contentdetail&event=actionclick&ident="+e.attr("ident"),!0,function(e){BuildContentDetailfromXML(e)})}function BuildSearchReservation(e){var t='<div class="conndetail"><div class="conndetail-inhtml"><div class="timelimit">Od: <input class="inputdatepicker" type="text" name="fromdate"/> Do: <input class="inputdatepicker" type="text" name="todate"> Nalezeno: <span class="searchcount"></span><img src="../images/cross.png" /></div><div class="reservations"></div></div></div>',n=$(t).appendTo(".adm-day-conn");n.find(".timelimit img").height(15),n.on("mouseover",".timelimit img",function(){$(this).attr("src","../images/crossActive.png")}),n.on("mouseout",".timelimit img",function(){$(this).attr("src","../images/cross.png")}),n.on("click",".timelimit img",function(){$(".search-textbox input[type=text]").val(""),n.remove()}),n.find(".conndetail-inhtml").css({padding:0}),n.find(".conndetail-inhtml .reservations").css({maxHeight:$(".adm-day-conn").height()-$(".conndetail-inhtml .timelimit").outerHeight()-2}),n.find("input[name=fromdate]").datepicker({beforeShowDay:function(e){var t=new Array(!0,""),n=StrToDate($(".conndetail-inhtml input[name=todate]").val());return isNaN(n)||e>n&&(t[0]=!1),t}}),n.find("input[name=todate]").datepicker({beforeShowDay:function(e){var t=new Array(!0,""),n=StrToDate($(".conndetail-inhtml input[name=fromdate]").val());return isNaN(n)||n>e&&(t[0]=!1),t}}),$(".conndetail-inhtml").on("change",".inputdatepicker",function(){SearchReservations(n,e)}),$(".conndetail-inhtml input[name=fromdate]").datepicker("setDate",new Date),SearchReservations(n,e)}function SearchReservations(e,t){var n=0;SendAjaxRequest("type=reservationsearch&searchtext="+t+"&fromdate="+$(".conndetail-inhtml input[name=fromdate]").val()+"&todate="+$(".conndetail-inhtml input[name=todate]").val(),!0,function(t){$(".conndetail-inhtml .reservations").empty(),0==$(t).find("reservation").length?$('<div class="noresfound">Žádné odpovídající rezervace</div>').appendTo(e.find(".conndetail-inhtml .reservations")):n=BuildSearch3(e,t),$(".conndetail-inhtml .searchcount").text(n)})}function BuildSearch3(e,t){var n=0,i="";return $(t).find("reservation").each(function(){var t="";i!=$(this).attr("fromdate")&&(t+='<div class="daycap">'+$(this).attr("fromdate")+"</div>",i=$(this).attr("fromdate")),t+='<table class="reservation" pk="'+$(this).attr("respk")+'" termpk="'+$(this).attr("termpk")+'" date="'+$(this).attr("fromdate")+'"><td width="50" style="padding-left: 30px;">'+$(this).attr("fromtime")+'</td><td width="100%">'+$(this).attr("firstname")+" "+$(this).attr("lastname")+"</td><td>Vytvořeno: "+$(this).attr("created")+"</td></table>",$(t).appendTo(e.find(".conndetail-inhtml .reservations")),n++}),n}var FreeResConn=null,Reservations=[],FreeResConn=null,Freeresconnheight=250,Minimized=!0,SelBcgrColor="rgb(200,255,200)",TermMonthdata="<months></months>",PrevDate=0,ctrlKeyDown=!1,changeonyearfunc=null;document.addEventListener("DOMContentLoaded",function(e){document.body.addEventListener("keydown",function(e){116==(e.which||e.keyCode)||82==(e.which||e.keyCode)&&ctrlKeyDown?(e.stopPropagation(),e.preventDefault(),SendAjaxRequest("type=setnavigation&date="+DateToStr($("#datepicker").datepicker("getDate")),!1,function(e){"succes"==e&&window.location.reload()})):17==(e.which||e.keyCode)&&(ctrlKeyDown=!0)},!1)},!1),document.addEventListener("DOMContentLoaded",function(e){document.body.addEventListener("keyup",function(e){17==(e.which||e.keyCode)&&(ctrlKeyDown=!1)},!1)},!1),$(document).ready(function(){InitDatePicker(),LoadActNavigation(),BuildFreeResConn(),LoadFreeReservations(),$("body").on("click",".adm-newresconn-conn .reservation",function(){var e=$(this);DateSelect($("#datepicker"),e.attr("date"),function(){SelectTerm(e.attr("termpk"))})}),$("body").on("mouseover",".adm-newresconn-conn .reservation",function(){$('.adm-dayterms-view-term[pk="'+$(this).attr("termpk")+'"]').addClass("selhover")}),$("body").on("mouseout",".adm-newresconn-conn .reservation",function(){$('.adm-dayterms-view-term[pk="'+$(this).attr("termpk")+'"]').removeClass("selhover")}),$(".adm-dayterms-tools-newbt").click(function(e){ClearContent(e)&&BuildTermsForm($("#datepicker").datepicker("getDate"))}),$(".adm-dayterms-view").on("click",".adm-dayterms-view-term",function(e){SelectTerm($(this).attr("pk"))}),$("body").on("click",".search-textbox img",function(e){var t=$(".search-textbox input").val();""!=t&&ClearContent(e)&&BuildSearchReservation(t)}),$("body").on("focusin",".search-textbox input",function(){$(this).bind("keydown",function(e){if(13==e.keyCode){var t=$(this).val();""!=t&&ClearContent(e)&&BuildSearchReservation(t)}})}),$("body").on("focusout",".search-textbox input",function(){$(this).unbind("keydown")}),$("body").on("click",".conndetail-inhtml .reservations .reservation",function(){var e=$(this);DateSelect($("#datepicker"),e.attr("date"),function(){SelectTerm(e.attr("termpk"))})}),setInterval(GetNewReservations,1e4)});